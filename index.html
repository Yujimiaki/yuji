<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Garagem Virtual V3</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="notification-area"><span id="notification-message"></span><button class="close-btn">×</button></div>

    <!-- LOGIN -->
    <div id="auth-container" class="card auth-box">
        <h2><i class="fas fa-warehouse"></i> Garagem V3</h2>
        <form id="formLogin">
            <h3>Entrar</h3>
            <input type="email" id="loginEmail" placeholder="E-mail" required>
            <input type="password" id="loginPassword" placeholder="Senha" required>
            <button type="submit">Entrar</button>
        </form>
        <hr style="margin: 20px 0;">
        <form id="formRegister">
            <h3>Criar Conta</h3>
            <input type="email" id="registerEmail" placeholder="E-mail" required>
            <input type="password" id="registerPassword" placeholder="Senha" required>
            <button type="submit" class="botao-info">Registrar</button>
        </form>
    </div>

    <!-- APP -->
    <div id="app-container" style="display: none;">
        <aside id="sidebar">
            <div class="sidebar-header"><h1>Garagem V3</h1></div>
            <button id="btnAbrirModalAdicionar" class="botao-sidebar-add">+ Veículo</button>
            <div class="lista-veiculos-container card">
                <ul id="listaVeiculosSidebar"></ul>
            </div>
            <button id="btnLogout" class="botao-perigo" style="margin-top: auto;">Sair</button>
        </aside>

        <main id="main-content">
            <div id="mensagem-selecione" class="card" style="text-align: center; padding: 50px;">
                <h2>Selecione um veículo na lista para começar</h2>
            </div>

            <!-- WRAPPER DO VEÍCULO SELECIONADO -->
            <div id="painelVeiculoSelecionado" style="display: none;">
                
                <!-- CABEÇALHO DO CARRO -->
                <div class="card vehicle-header">
                    <img id="imagemVeiculo" src="" alt="Foto do Veículo" onerror="this.src='https://via.placeholder.com/300x200?text=Sem+Foto+V%C3%A1lida';">
                    <div id="informacoesVeiculo">
                        <h2 id="info-modelo-placa">Modelo</h2>
                        <p id="info-proprietario"></p>
                        <p id="info-detalhes"></p>
                        <div style="margin-top: 10px;">
                            <button id="botaoCompartilharHeader" class="botao-info"><i class="fas fa-share-alt"></i></button>
                            <button id="botaoRemoverHeader" class="botao-perigo"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                </div>

                <!-- NAVEGAÇÃO POR ABAS -->
                <div class="tab-container">
                    <button class="tab-button active" onclick="mudarAba('painel')"><i class="fas fa-tachometer-alt"></i> Controle</button>
                    <!-- NOVA ABA SERVIÇOS -->
                    <button class="tab-button" onclick="mudarAba('servicos')"><i class="fas fa-clipboard-list"></i> Catálogo de Serviços</button>
                    <button class="tab-button" onclick="mudarAba('manutencao')"><i class="fas fa-tools"></i> Manutenções</button>
                    <button class="tab-button" onclick="mudarAba('viagens')"><i class="fas fa-route"></i> Clima & Viagens</button>
                </div>

                <!-- CONTEÚDO DAS ABAS -->
                
                <!-- ABA 1: PAINEL DE CONTROLE -->
                <div id="aba-painel" class="aba-conteudo active">
                    <div class="card painel-controle" style="text-align:center;">
                        <h3>Velocímetro</h3>
                        <div class="velocimetro-wrapper">
                            <div class="velocimetro"><div class="ponteiro" id="ponteiro-velocidade"></div></div>
                            <div class="display-velocidade"><span id="valor-velocidade">0</span> km/h</div>
                        </div>
                        <div class="controles">
                            <button id="btn-ligar" class="botao-sucesso">LIGAR</button>
                            <button id="btn-acelerar" disabled>Acelerar</button>
                            <button id="btn-frear" disabled>Frear</button>
                            <button id="btn-turbo" class="botao-aviso" style="display: none;">TURBO</button>
                        </div>
                    </div>
                </div>

                <!-- NOVA ABA: CATÁLOGO DE SERVIÇOS -->
                <div id="aba-servicos" class="aba-conteudo">
                    <div class="grid-servicos">
                        <!-- Serviço 1 -->
                        <div class="card-servico" onclick="preencherServico('Troca de Óleo Premium', 250)">
                            <div class="icone-servico"><i class="fas fa-oil-can"></i></div>
                            <h3>Troca de Óleo</h3>
                            <p>Óleo sintético de alta performance + filtro.</p>
                            <span class="preco-servico">R$ 250,00</span>
                            <button class="botao-mini">Agendar</button>
                        </div>

                        <!-- Serviço 2 -->
                        <div class="card-servico" onclick="preencherServico('Revisão Geral', 450)">
                            <div class="icone-servico"><i class="fas fa-wrench"></i></div>
                            <h3>Revisão Geral</h3>
                            <p>Checagem completa de freios, suspensão e fluidos.</p>
                            <span class="preco-servico">R$ 450,00</span>
                            <button class="botao-mini">Agendar</button>
                        </div>

                        <!-- Serviço 3 -->
                        <div class="card-servico" onclick="preencherServico('Balanceamento & Pneus', 120)">
                            <div class="icone-servico"><i class="fas fa-sync-alt"></i></div>
                            <h3>Alinhamento 3D</h3>
                            <p>Balanceamento das 4 rodas e geometria completa.</p>
                            <span class="preco-servico">R$ 120,00</span>
                            <button class="botao-mini">Agendar</button>
                        </div>

                        <!-- Serviço 4 -->
                        <div class="card-servico" onclick="preencherServico('Lavagem Americana', 80)">
                            <div class="icone-servico"><i class="fas fa-pump-soap"></i></div>
                            <h3>Lavagem Detalhada</h3>
                            <p>Limpeza interna e externa com cera.</p>
                            <span class="preco-servico">R$ 80,00</span>
                            <button class="botao-mini">Agendar</button>
                        </div>

                         <!-- Serviço 5 - Checkup de Viagem -->
                         <div class="card-servico destaque" onclick="preencherViagemHelper()">
                            <div class="icone-servico"><i class="fas fa-plane-departure"></i></div>
                            <h3>Planejar Viagem</h3>
                            <p>Quer viajar? Verifique o clima e defina o destino.</p>
                            <span class="preco-servico">Grátis</span>
                            <button class="botao-mini">Ir para Viagens</button>
                        </div>
                    </div>
                </div>

                <!-- ABA 3: MANUTENÇÕES -->
                <div id="aba-manutencao" class="aba-conteudo">
                    <div class="card">
                        <h3>Agendar/Registrar Manutenção</h3>
                        <form id="formManutencao" class="form-linha">
                            <div class="campo-grupo">
                                <label>Data do Serviço:</label>
                                <input type="date" id="inputDataManutencao" name="data" required>
                            </div>
                            <div class="campo-grupo">
                                <label>Serviço:</label>
                                <input type="text" id="inputDescManutencao" name="descricaoServico" placeholder="Ex: Troca de óleo" required>
                            </div>
                            <div class="campo-grupo">
                                <label>Valor:</label>
                                <input type="number" id="inputCustoManutencao" name="custo" placeholder="R$ 0.00" required>
                            </div>
                            <button type="submit" class="botao-info" style="align-self: flex-end;">Salvar</button>
                        </form>
                        <hr>
                        <h4>Histórico de Manutenções</h4>
                        <ul id="lista-manutencoes" class="lista-clean"></ul>
                    </div>
                </div>

                <!-- ABA 4: CLIMA E VIAGEM -->
                <div id="aba-viagens" class="aba-conteudo">
                    <div class="grid-layout">
                        <!-- Clima -->
                        <div class="card">
                            <h3><i class="fas fa-cloud-sun"></i> Consultar Clima</h3>
                            <div style="display:flex; gap:10px; margin-bottom:15px;">
                                <input type="text" id="cidadeClima" placeholder="Digite a Cidade (Ex: São Paulo)">
                                <button onclick="buscarClima()" class="botao-info">Buscar</button>
                            </div>
                            <div id="resultadoClima" style="display:none; text-align:center; padding:10px; background:#f0f8ff; border-radius:8px;">
                                <h2 id="clima-cidade">--</h2>
                                <h1 id="clima-temp">--°C</h1>
                                <p id="clima-desc">--</p>
                                <img id="clima-icone" src="" alt="icon">
                            </div>
                        </div>

                        <!-- Nova Viagem -->
                        <div class="card">
                            <h3><i class="fas fa-calendar-plus"></i> Agendar Viagem</h3>
                            <form id="formViagem">
                                <label>Destino:</label>
                                <input type="text" name="destino" id="inputDestinoViagem" placeholder="Para onde?" required>
                                
                                <label>Data de Ida:</label>
                                <input type="date" name="dataIda" required>
                                
                                <label>Notas:</label>
                                <input type="text" name="descricao" placeholder="Obs...">
                                
                                <input type="hidden" name="previsaoClima" id="inputClimaViagem">

                                <button type="submit" class="botao-sucesso" style="width:100%;">Agendar Viagem</button>
                            </form>
                        </div>
                    </div>
                    
                    <div class="card" style="margin-top: 20px;">
                        <h4>Minhas Viagens</h4>
                        <ul id="lista-viagens" class="lista-clean"></ul>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- MODAL NOVO VEÍCULO -->
    <dialog id="modalAdicionarVeiculo">
        <form id="formNovoVeiculo">
            <h2>Novo Veículo</h2>
            <div class="form-grid">
                <div class="form-item span-2">
                    <label>Link da Imagem (URL):</label> 
                    <input type="url" name="imagemUrl" placeholder="Cole o link da imagem aqui">
                    <small style="color:#666; font-size:0.8em;">* Recomendado links terminados em .jpg ou .png</small>
                </div>
                <div class="form-item span-2">
                    <label>Tipo:</label>
                    <select name="tipo" required>
                        <option value="Carro">Carro</option>
                        <option value="Carro Esportivo">Esportivo</option>
                        <option value="Caminhão">Caminhão</option>
                    </select>
                </div>
                <div class="form-item"><label>Marca:</label><input type="text" name="marca" required></div>
                <div class="form-item"><label>Modelo:</label><input type="text" name="modelo" required></div>
                <div class="form-item"><label>Placa:</label><input type="text" name="placa" required></div>
                <div class="form-item"><label>Ano:</label><input type="number" name="ano" required></div>
                <div class="form-item span-2"><label>Cor:</label><input type="text" name="cor" required></div>
            </div>
            <div class="modal-actions">
                <button type="button" id="btnFecharModalAdicionar" class="botao-cancelar">Cancelar</button>
                <button type="submit" class="botao-sucesso">Salvar</button>
            </div>
        </form>
    </dialog>

    <script type="module" src="js/principal.js"></script>
    
    <!-- Lógica Simples de Troca de Abas -->
    <script>
        function mudarAba(abaNome) {
            document.querySelectorAll('.aba-conteudo').forEach(div => div.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById('aba-' + abaNome).classList.add('active');
            
            const botoes = document.querySelectorAll('.tab-button');
            // Gambiarra simples para mapear botão ao indice, em app real usaria IDs
            if(abaNome === 'painel') botoes[0].classList.add('active');
            if(abaNome === 'servicos') botoes[1].classList.add('active');
            if(abaNome === 'manutencao') botoes[2].classList.add('active');
            if(abaNome === 'viagens') botoes[3].classList.add('active');
        }

        // FUNÇÃO INTELIGENTE DO CATÁLOGO DE SERVIÇOS
        // Ao clicar no serviço, vai pra aba de manutenção e preenche sozinho
        function preencherServico(nomeServico, valor) {
            mudarAba('manutencao');
            document.getElementById('inputDescManutencao').value = nomeServico;
            document.getElementById('inputCustoManutencao').value = valor;
            
            // Define data para Hoje
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('inputDataManutencao').value = hoje;
            
            // Avisa o usuário (usando a função de notificação global acessível via window se necessário, ou alert simples)
            // Aqui vamos confiar no visual da troca de aba
        }

        function preencherViagemHelper() {
            mudarAba('viagens');
        }
    </script>
</body>
</html>