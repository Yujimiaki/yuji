<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Garagem Virtual V3 - Final</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="notification-area"><span id="notification-message"></span><button class="close-btn">×</button></div>

    <!-- TELA DE LOGIN -->
    <div id="auth-container" class="card auth-box">
        <h2><i class="fas fa-warehouse"></i> Garagem V3</h2>
        <form id="formLogin">
            <h3>Entrar</h3>
            <input type="email" id="loginEmail" placeholder="E-mail" required>
            <input type="password" id="loginPassword" placeholder="Senha" required>
            <button type="submit">Entrar</button>
        </form>
        <hr style="margin: 20px 0;">
        <form id="formRegister">
            <h3>Criar Conta</h3>
            <input type="email" id="registerEmail" placeholder="E-mail" required>
            <input type="password" id="registerPassword" placeholder="Senha" required>
            <button type="submit" class="botao-info">Registrar</button>
        </form>
    </div>

    <!-- APLICAÇÃO PRINCIPAL -->
    <div id="app-container" style="display: none;">
        <aside id="sidebar">
            <div class="sidebar-header"><h1>Garagem V3</h1></div>
            <button id="btnAbrirModalAdicionar" class="botao-sidebar-add">+ Veículo</button>
            <div class="lista-veiculos-container card">
                <ul id="listaVeiculosSidebar"></ul>
            </div>
            <button id="btnLogout" class="botao-perigo" style="margin-top: auto;">Sair</button>
        </aside>

        <main id="main-content">
            <div id="mensagem-selecione" class="card" style="text-align: center; padding: 50px;">
                <h2><i class="fas fa-arrow-left"></i> Selecione um veículo na lista para começar</h2>
            </div>

            <!-- ÁREA DO VEÍCULO SELECIONADO -->
            <div id="painelVeiculoSelecionado" style="display: none;">
                
                <!-- CABEÇALHO COM FOTO E DADOS -->
                <div class="card vehicle-header">
                    <img id="imagemVeiculo" src="" alt="Carro" onerror="this.src='https://via.placeholder.com/300x200?text=Sem+Foto';">
                    <div id="informacoesVeiculo">
                        <h2 id="info-modelo-placa">Modelo</h2>
                        <p id="info-proprietario"></p>
                        <p id="info-detalhes"></p>
                        <div style="margin-top: 10px;">
                            <button id="botaoCompartilharHeader" class="botao-info" title="Compartilhar"><i class="fas fa-share-alt"></i></button>
                            <button id="botaoRemoverHeader" class="botao-perigo" title="Excluir Carro"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                </div>

                <!-- MENU DE ABAS (CORRIGIDO) -->
                <div class="tab-container">
                    <button class="tab-button active" onclick="mudarAba(event, 'aba-painel')"><i class="fas fa-tachometer-alt"></i> Controle</button>
                    <!-- AQUI ESTÁ O BOTÃO DOS SERVIÇOS -->
                    <button class="tab-button" onclick="mudarAba(event, 'aba-servicos')"><i class="fas fa-clipboard-list"></i> Nossos Serviços</button>
                    <button class="tab-button" onclick="mudarAba(event, 'aba-manutencao')"><i class="fas fa-tools"></i> Manutenções</button>
                    <button class="tab-button" onclick="mudarAba(event, 'aba-viagens')"><i class="fas fa-route"></i> Clima & Viagens</button>
                </div>

                <!-- --- ABA 1: CONTROLE --- -->
                <div id="aba-painel" class="aba-conteudo active">
                    <div class="card painel-controle" style="text-align:center;">
                        <h3>Velocímetro</h3>
                        <div class="velocimetro-wrapper">
                            <div class="velocimetro"><div class="ponteiro" id="ponteiro-velocidade"></div></div>
                            <div class="display-velocidade"><span id="valor-velocidade">0</span> km/h</div>
                        </div>
                        <div class="controles">
                            <button id="btn-ligar" class="botao-sucesso">LIGAR</button>
                            <button id="btn-acelerar" disabled>Acelerar</button>
                            <button id="btn-frear" disabled>Frear</button>
                            <button id="btn-turbo" class="botao-aviso" style="display: none;">TURBO</button>
                        </div>
                    </div>
                </div>

                <!-- --- ABA 2: NOSSOS SERVIÇOS (A NOVA ABA) --- -->
                <div id="aba-servicos" class="aba-conteudo">
                    <h3 style="margin-bottom: 15px;">Serviços Disponíveis na Oficina</h3>
                    <div class="grid-servicos">
                        
                        <!-- CARD 1 -->
                        <div class="card-servico" onclick="agendarServicoRapido('Troca de Óleo Completa', 250)">
                            <div class="icone-servico"><i class="fas fa-oil-can"></i></div>
                            <h3>Troca de Óleo</h3>
                            <p>Óleo Sintético 5W30 + Filtro.</p>
                            <span class="preco-servico">R$ 250,00</span>
                            <button class="botao-mini">Agendar</button>
                        </div>

                        <!-- CARD 2 -->
                        <div class="card-servico" onclick="agendarServicoRapido('Alinhamento e Balanceamento', 120)">
                            <div class="icone-servico"><i class="fas fa-arrows-alt-h"></i></div>
                            <h3>Alinhamento 3D</h3>
                            <p>Ajuste de geometria e balanceamento.</p>
                            <span class="preco-servico">R$ 120,00</span>
                            <button class="botao-mini">Agendar</button>
                        </div>

                        <!-- CARD 3 -->
                        <div class="card-servico" onclick="agendarServicoRapido('Revisão de Freios', 350)">
                            <div class="icone-servico"><i class="fas fa-exclamation-triangle"></i></div>
                            <h3>Freios</h3>
                            <p>Troca de pastilhas dianteiras.</p>
                            <span class="preco-servico">R$ 350,00</span>
                            <button class="botao-mini">Agendar</button>
                        </div>

                         <!-- CARD 4 -->
                         <div class="card-servico" onclick="agendarServicoRapido('Lavagem Detalhada', 80)">
                            <div class="icone-servico"><i class="fas fa-pump-soap"></i></div>
                            <h3>Lavagem</h3>
                            <p>Interna e externa com cera.</p>
                            <span class="preco-servico">R$ 80,00</span>
                            <button class="botao-mini">Agendar</button>
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">* Clique em um serviço para adicioná-lo automaticamente ao histórico de manutenção.</p>
                </div>

                <!-- --- ABA 3: MANUTENÇÕES --- -->
                <div id="aba-manutencao" class="aba-conteudo">
                    <div class="card">
                        <h3><i class="fas fa-edit"></i> Registrar Manutenção</h3>
                        <form id="formManutencao" class="form-linha">
                            <div class="campo-grupo">
                                <label>Data:</label>
                                <input type="date" id="inputDataManutencao" name="data" required>
                            </div>
                            <div class="campo-grupo" style="flex:2;">
                                <label>Descrição do Serviço:</label>
                                <input type="text" id="inputDescManutencao" name="descricaoServico" placeholder="O que foi feito?" required>
                            </div>
                            <div class="campo-grupo">
                                <label>Valor (R$):</label>
                                <input type="number" id="inputCustoManutencao" name="custo" placeholder="0.00" required>
                            </div>
                            <button type="submit" class="botao-info" style="height: 48px; margin-top: auto;">Salvar</button>
                        </form>
                    </div>

                    <div class="card" style="margin-top:20px;">
                        <h4>Histórico do Veículo</h4>
                        <ul id="lista-manutencoes" class="lista-clean">
                            <li style="padding:10px; text-align:center;">Carregando...</li>
                        </ul>
                    </div>
                </div>

                <!-- --- ABA 4: VIAGENS E CLIMA --- -->
                <div id="aba-viagens" class="aba-conteudo">
                    <div class="grid-layout">
                        <!-- CLIMA -->
                        <div class="card">
                            <h3><i class="fas fa-cloud-sun"></i> Ver Clima</h3>
                            <div style="display:flex; gap:10px;">
                                <input type="text" id="cidadeClima" placeholder="Digite a Cidade...">
                                <button onclick="buscarClima()" class="botao-info">Ok</button>
                            </div>
                            <div id="resultadoClima" style="display:none; text-align:center; margin-top:15px; background:#e3f2fd; padding:10px; border-radius:8px;">
                                <h3 id="clima-cidade" style="margin:0;">--</h3>
                                <div style="display:flex; justify-content:center; align-items:center;">
                                    <img id="clima-icone" src="" alt="img">
                                    <h1 id="clima-temp" style="font-size:3em; margin:0;">--</h1>
                                </div>
                                <p id="clima-desc">--</p>
                            </div>
                        </div>

                        <!-- AGENDAR VIAGEM -->
                        <div class="card">
                            <h3><i class="fas fa-map-marked-alt"></i> Nova Viagem</h3>
                            <form id="formViagem">
                                <label>Destino:</label>
                                <input type="text" id="inputDestinoViagem" name="destino" required>
                                <label>Data:</label>
                                <input type="date" name="dataIda" required>
                                <label>Obs:</label>
                                <input type="text" name="descricao">
                                <input type="hidden" id="inputClimaViagem" name="previsaoClima">
                                <button type="submit" class="botao-sucesso" style="width:100%; margin-top:10px;">Agendar</button>
                            </form>
                        </div>
                    </div>

                    <div class="card" style="margin-top:20px;">
                        <h4>Próximas Viagens</h4>
                        <ul id="lista-viagens" class="lista-clean"></ul>
                    </div>
                </div>

            </div> <!-- FIM PAINEL VEICULO -->
        </main>
    </div>

    <!-- MODAL ADICIONAR CARRO (MANTIDO IGUAL) -->
    <dialog id="modalAdicionarVeiculo">
        <form id="formNovoVeiculo">
            <h2>Adicionar Veículo</h2>
            <div class="form-grid">
                <div class="form-item span-2">
                    <label>URL da Imagem:</label>
                    <input type="url" name="imagemUrl" placeholder="https://exemplo.com/carro.jpg">
                </div>
                <div class="form-item span-2">
                    <label>Tipo:</label>
                    <select name="tipo"><option>Carro</option><option>Carro Esportivo</option><option>Caminhão</option></select>
                </div>
                <div class="form-item"><label>Marca:</label><input type="text" name="marca" required></div>
                <div class="form-item"><label>Modelo:</label><input type="text" name="modelo" required></div>
                <div class="form-item"><label>Placa:</label><input type="text" name="placa" required></div>
                <div class="form-item"><label>Ano:</label><input type="number" name="ano" required></div>
                <div class="form-item span-2"><label>Cor:</label><input type="text" name="cor" required></div>
            </div>
            <div class="modal-actions">
                <button type="button" id="btnFecharModalAdicionar" class="botao-cancelar">Cancelar</button>
                <button type="submit" class="botao-sucesso">Salvar</button>
            </div>
        </form>
    </dialog>

    <script type="module" src="js/principal.js"></script>

    <!-- SCRIPT DE ABAS ROBUSTO -->
    <script>
        // Função universal para trocar abas
        function mudarAba(event, idAbaDestino) {
            // 1. Esconde todo conteudo de aba
            document.querySelectorAll('.aba-conteudo').forEach(div => div.classList.remove('active'));
            
            // 2. Remove o estilo 'active' de todos os botoes
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));

            // 3. Mostra a aba certa
            const aba = document.getElementById(idAbaDestino);
            if(aba) {
                aba.classList.add('active');
            } else {
                console.error('Aba não encontrada:', idAbaDestino);
            }

            // 4. Marca o botao clicado como ativo
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('active');
            }
        }

        // Função do Catalogo de Serviços
        function agendarServicoRapido(nome, valor) {
            // Clica automaticamente no botão da aba manutenção
            // Para trocar visualmente
            const botoes = document.querySelectorAll('.tab-button');
            // Gambiarra segura: O 3º botão é o de manutenção (indice 2)
            if(botoes[2]) botoes[2].click(); 

            // Preenche o formulário
            document.getElementById('inputDescManutencao').value = nome;
            document.getElementById('inputCustoManutencao').value = valor;
            
            // Poe a data de hoje
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('inputDataManutencao').value = hoje;

            // Alerta visual rapido
            alert('Serviço "' + nome + '" selecionado! Confira os dados e clique em Salvar.');
        }
    </script>
</body>
</html>